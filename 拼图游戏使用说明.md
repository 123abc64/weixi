# 自定义拼图游戏 - 使用说明

## 📱 游戏介绍

这是一个基于微信小程序的自定义图片拼图游戏，支持用户上传自己的图片，自动切割成九宫格拼图进行游戏。

## 🎮 游戏特点

- **自定义图片**：支持拍照或从相册选择图片
- **九宫格拼图**：将图片精确分割成3×3的九宫格
- **传统玩法**：使用8块拼图和1个空位，通过移动来完成拼图
- **实时统计**：显示步数和游戏时间
- **预览功能**：可随时查看原图作为参考
- **数字提示**：支持显示/隐藏数字帮助
- **胜利动画**：完成拼图后的庆祝界面

## 🎯 游戏玩法

### 1. 上传图片
- 点击"点击上传图片"区域
- 选择"从相册选择"或"拍照"
- 选择一张适合的图片（建议使用正方形或接近正方形的图片）

### 2. 开始游戏
- 上传图片后，点击"开始拼图"按钮
- 系统会自动将图片切割成九宫格
- 拼图会自动打乱，保证有解

### 3. 移动拼图
- **规则**：只能移动与空格相邻的拼图块
- **操作**：点击要移动的拼图块
- **反馈**：移动成功会有轻微震动，无效移动会有中等震动

### 4. 游戏控制
- **预览原图**：查看完整的原始图片
- **显示/隐藏数字**：在拼图块上显示对应的数字编号
- **重新开始**：使用同一张图片重新开始游戏
- **返回上传**：上传新的图片

## 🏆 胜利条件

当所有拼图块都回到原始位置时，游戏即完成：
- 前8个位置显示对应的拼图块
- 第9个位置（右下角）为空位

## 💡 游戏技巧

1. **从角落开始**：通常先完成四角的拼图块
2. **逐行完成**：可以尝试从第一行开始，逐行完成
3. **利用预览**：随时查看原图确认拼图块的正确位置
4. **数字辅助**：如果遇到困难，可以开启数字提示

## 🔧 技术实现

### 图片处理
- 使用Canvas API进行真实的图片切割
- 将原图精确分割成3×3的九宫格，每块尺寸完全相同
- 切割过程：
  1. 获取原图尺寸，计算每个拼图块的精确尺寸
  2. 使用Canvas逐个切割原图的对应区域
  3. 将每个切割结果保存为独立的临时图片文件
  4. 确保切割的9块图片不重复且能完美拼接

### 切割算法
- 均等分割：将图片按3行3列精确分割
- 坐标计算：
  - 第1块：(0,0) → (pieceWidth, pieceHeight)
  - 第2块：(pieceWidth,0) → (2×pieceWidth, pieceHeight)
  - ...
  - 第9块：(2×pieceWidth,2×pieceHeight) → (3×pieceWidth, 3×pieceHeight)
- 质量保证：切割后的图片块之间无缝拼接，完美还原原图

### 拼图打乱算法
- 使用模拟有效移动的方式打乱
- 确保拼图一定有解
- 通过50-100次随机移动达到充分打乱的效果

### 移动逻辑
- 检查点击的拼图块是否与空格相邻
- 交换拼图块和空格的位置
- 更新当前位置并检查胜利条件

## 📋 文件结构

```
miniprogram/pages/upload/
├── upload.js      # 主要游戏逻辑
├── upload.wxml    # 页面结构
├── upload.wxss    # 页面样式
└── upload.json    # 页面配置
```

## 🚀 部署说明

1. 使用微信开发者工具打开项目
2. 确保项目配置正确
3. 上传图片功能需要在真机上测试
4. 确保小程序有相机和相册权限

## 🐛 常见问题

**Q: 为什么图片处理很慢？**
A: 新版本使用CSS背景定位，处理速度很快。如果遇到慢的情况，可能是图片文件太大。

**Q: 为什么无法移动某个拼图块？**
A: 只有与空格相邻的拼图块才能移动，这是拼图游戏的标准规则。

**Q: 如何确保拼图有解？**
A: 游戏使用模拟移动的方式打乱，确保从完整状态出发，所以一定有解。

**Q: 支持哪些图片格式？**
A: 支持JPG、PNG等常见格式，建议使用正方形图片获得最佳效果。

---

祝您游戏愉快！🎉