# è‡ªå®šä¹‰æ‹¼å›¾æ¸¸æˆ - IDE å¼€å‘æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºå¾®ä¿¡å°ç¨‹åºçš„æ™ºèƒ½å›¾ç‰‡åˆ‡å‰²æ‹¼å›¾æ¸¸æˆï¼Œæ”¯æŒç”¨æˆ·ä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡ï¼Œé€šè¿‡åç«¯æœåŠ¡è¿›è¡Œ3Ã—3ä¹å®«æ ¼åˆ‡å‰²ï¼Œå®ç°çœŸå®çš„æ‹¼å›¾æ¸¸æˆä½“éªŒã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

- **æ™ºèƒ½å›¾ç‰‡åˆ‡å‰²**ï¼šç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ â†’ åç«¯3Ã—3åˆ‡å‰² â†’ è¿”å›9å¼ æ‹¼å›¾å—
- **æ‹¼å›¾æ¸¸æˆ**ï¼šä¼ ç»Ÿä¹å®«æ ¼æ‹¼å›¾ç©æ³•ï¼ˆ8å—å›¾ç‰‡+1ä¸ªç©ºä½ï¼‰
- **å®Œæ•´æ¸¸æˆç³»ç»Ÿ**ï¼šè®¡æ­¥ã€è®¡æ—¶ã€èƒœåˆ©æ£€æµ‹ã€é¢„è§ˆåŠŸèƒ½
- **åŒé‡æ¶æ„**ï¼šå¾®ä¿¡å°ç¨‹åºå‰ç«¯ + FastAPIåç«¯æœåŠ¡

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
æ‹¼å›¾æ¸¸æˆ/
â”œâ”€â”€ backend/                          # åç«¯æœåŠ¡ï¼ˆFastAPIï¼‰
â”‚   â”œâ”€â”€ main.py                       # ä¸»æœåŠ¡æ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt                # Pythonä¾èµ–
â”‚   â””â”€â”€ README.md                     # åç«¯éƒ¨ç½²æŒ‡å—
â”‚
â”œâ”€â”€ miniprogram/                      # å¾®ä¿¡å°ç¨‹åºå‰ç«¯
â”‚   â”œâ”€â”€ app.js                        # å°ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ app.json                      # å°ç¨‹åºé…ç½®
â”‚   â”œâ”€â”€ pages/                        # é¡µé¢ç›®å½•
â”‚   â”‚   â”œâ”€â”€ index/                    # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ upload/                   # å›¾ç‰‡ä¸Šä¼ é¡µé¢ï¼ˆCanvasåˆ‡å‰²ï¼‰
â”‚   â”‚   â””â”€â”€ split/                    # æ™ºèƒ½åˆ‡å‰²é¡µé¢ï¼ˆåç«¯åˆ‡å‰²ï¼‰
â”‚   â”‚       â”œâ”€â”€ split.js               # é¡µé¢é€»è¾‘
â”‚   â”‚       â”œâ”€â”€ split.wxml             # é¡µé¢ç»“æ„
â”‚   â”‚       â”œâ”€â”€ split.wxss             # é¡µé¢æ ·å¼
â”‚   â”‚       â”œâ”€â”€ split.json             # é¡µé¢é…ç½®
â”‚   â”‚       â””â”€â”€ README.md             # å‰ç«¯é…ç½®æŒ‡å—
â”‚   â””â”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ æ‹¼å›¾æ¸¸æˆä½¿ç”¨è¯´æ˜.md               # ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ
â”œâ”€â”€ å›¾ç‰‡å¤„ç†å¤±è´¥è¯Šæ–­æŒ‡å—.md             # é—®é¢˜è¯Šæ–­æŒ‡å—
â””â”€â”€ IDE-README.md                    # æœ¬æ–‡ä»¶ï¼ˆIDEå¼€å‘æŒ‡å—ï¼‰
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**ï¼šå¾®ä¿¡å°ç¨‹åºåŸç”Ÿæ¡†æ¶
- **UIè®¾è®¡**ï¼šç°ä»£åŒ–æ¸å˜èƒŒæ™¯ï¼Œæµç•…åŠ¨ç”»
- **ç»„ä»¶åº“**ï¼šè‡ªå®šä¹‰ç»„ä»¶
- **API**ï¼šwx.chooseMedia, wx.uploadFile, wx.downloadFile

### åç«¯æŠ€æœ¯
- **æ¡†æ¶**ï¼šFastAPI 0.104.1
- **æœåŠ¡å™¨**ï¼šUvicorn ASGIæœåŠ¡å™¨
- **å›¾ç‰‡å¤„ç†**ï¼šPillow (PIL) 10.0.1
- **æ–‡ä»¶ä¸Šä¼ **ï¼špython-multipart
- **å¼‚æ­¥IO**ï¼šaiofiles

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **å¾®ä¿¡å¼€å‘è€…å·¥å…·**ï¼šæœ€æ–°ç¨³å®šç‰ˆ
- **Python**ï¼š3.8+ï¼ˆæ¨è3.9ï¼‰
- **Node.js**ï¼šå°ç¨‹åºå¼€å‘éœ€è¦

### 1. å…‹éš†é¡¹ç›®

```bash
cd "d:/å¤§äºŒä¸Š/æ‹¼å›¾æ¸¸æˆ"
```

### 2. é…ç½®åç«¯

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¸¦è‡ªåŠ¨é‡è½½ï¼‰
python main.py

# æˆ–ä½¿ç”¨uvicornç›´æ¥å¯åŠ¨
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

åç«¯å°†åœ¨ `http://localhost:8000` å¯åŠ¨

### 4. é…ç½®å°ç¨‹åº

#### ä¿®æ”¹åç«¯åœ°å€

æ‰“å¼€ `miniprogram/pages/split/split.js`ï¼Œä¿®æ”¹baseUrlï¼š

```javascript
Page({
  data: {
    baseUrl: "http://localhost:8000",  // ä¿®æ”¹ä¸ºä½ çš„åç«¯åœ°å€
    // ...
  }
});
```

#### é…ç½®å¼€å‘è€…å·¥å…·

1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
2. å¯¼å…¥é¡¹ç›®ï¼šé€‰æ‹© `miniprogram` ç›®å½•
3. è®¾ç½® â†’ é¡¹ç›®è®¾ç½® â†’ æœ¬åœ°è®¾ç½®
4. å‹¾é€‰"ä¸æ ¡éªŒåˆæ³•åŸŸåã€web-viewï¼ˆä¸šåŠ¡åŸŸåï¼‰ã€TLSç‰ˆæœ¬ä»¥åŠHTTPSè¯ä¹¦"

### 5. è¿è¡Œå°ç¨‹åº

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ç‚¹å‡»"ç¼–è¯‘"å³å¯é¢„è§ˆ

## ğŸ“– å¼€å‘æŒ‡å—

### å‰ç«¯å¼€å‘

#### æ–‡ä»¶ç»“æ„è¯´æ˜

**split.js** - é¡µé¢é€»è¾‘
- `chooseImage()`: é€‰æ‹©å›¾ç‰‡
- `uploadAndSplit()`: ä¸Šä¼ åˆ°åç«¯
- `startGame()`: å¼€å§‹æ¸¸æˆ
- `movePiece()`: ç§»åŠ¨æ‹¼å›¾å—
- `checkWin()`: æ£€æŸ¥èƒœåˆ©æ¡ä»¶

**split.wxml** - é¡µé¢ç»“æ„
- ä¸Šä¼ åŒºåŸŸ
- åˆ‡å‰²ç»“æœé¢„è§ˆ
- æ‹¼å›¾æ¸¸æˆåŒºåŸŸ
- èƒœåˆ©å¼¹çª—

**split.wxss** - é¡µé¢æ ·å¼
- æ¸å˜èƒŒæ™¯
- ç½‘æ ¼å¸ƒå±€
- åŠ¨ç”»æ•ˆæœ

#### ä¿®æ”¹æ¥å£åœ°å€

```javascript
// åœ¨ split.js ä¸­ä¿®æ”¹
data: {
  baseUrl: "http://your-backend-ip:8000",  // ä¿®æ”¹è¿™é‡Œ
}
```

#### ä¿®æ”¹æ ·å¼ä¸»é¢˜

```css
/* åœ¨ split.wxss ä¸­ä¿®æ”¹ä¸»è‰²è°ƒ */
.container {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.start-btn {
  background: linear-gradient(45deg, #4facfe, #00f2fe);
}
```

### åç«¯å¼€å‘

#### å¯åŠ¨æ–¹å¼

**å¼€å‘æ¨¡å¼**ï¼ˆè‡ªåŠ¨é‡è½½ï¼‰
```bash
python main.py
```

**ç”Ÿäº§æ¨¡å¼**ï¼ˆæ¨èï¼‰
```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
```

#### ä¿®æ”¹é…ç½®

```python
# åœ¨ main.py ä¸­ä¿®æ”¹

# è·¨åŸŸé…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ä¸Šçº¿æ”¹ä¸ºå…·ä½“åŸŸå
    # ...
)

# å­˜å‚¨ç›®å½•é…ç½®
UPLOAD_DIR = "uploads"
GRID_DIR = "grid_images"
STATIC_DIR = "static"

# ç«¯å£é…ç½®
uvicorn.run(app, host="0.0.0.0", port=8000)
```

#### æ·»åŠ æ–°æ¥å£

```python
from fastapi import APIRouter

router = APIRouter()

@router.get("/custom-endpoint")
async def custom_function():
    return {"message": "Hello"}

# åœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œ
app.include_router(router)
```

### æ•°æ®æµç¨‹

#### å›¾ç‰‡ä¸Šä¼ æµç¨‹

```
ç”¨æˆ·é€‰æ‹©å›¾ç‰‡
    â†“
wx.chooseMedia()
    â†“
è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„
    â†“
wx.uploadFile()
    â†“
POST /upload (åç«¯)
    â†“
åç«¯ä¿å­˜åŸå›¾
    â†“
PILåˆ‡å‰²æˆ3Ã—3
    â†“
ä¿å­˜9å¼ å›¾ç‰‡åˆ°grid_images/
    â†“
è¿”å›9å¼ å›¾ç‰‡URL
    â†“
å°ç¨‹åºæ˜¾ç¤ºåˆ‡å‰²ç»“æœ
    â†“
ç”¨æˆ·å¼€å§‹æ‹¼å›¾æ¸¸æˆ
```

#### æ‹¼å›¾æ¸¸æˆæµç¨‹

```
åˆå§‹åŒ–9ä¸ªæ‹¼å›¾å—
    â†“
æ™ºèƒ½æ‰“ä¹±ï¼ˆ50æ¬¡éšæœºç§»åŠ¨ï¼‰
    â†“
ç”¨æˆ·ç‚¹å‡»æ‹¼å›¾å—
    â†“
æ£€æŸ¥æ˜¯å¦ä¸ç©ºæ ¼ç›¸é‚»
    â†“
äº¤æ¢ä½ç½®
    â†“
æ›´æ–°æ­¥æ•°
    â†“
æ£€æŸ¥æ˜¯å¦å®Œæˆ
    â†“
æ˜¾ç¤ºèƒœåˆ©å¼¹çª—
```

## ğŸ”§ é…ç½®è¯¦è§£

### ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# åç«¯é…ç½®
API_HOST=0.0.0.0
API_PORT=8000
DEBUG=True

# å°ç¨‹åºé…ç½®
MINIAPP_BASE_URL=http://localhost:8000
```

### å°ç¨‹åºé…ç½®æ–‡ä»¶

**app.json**
```json
{
  "pages": [
    "pages/index/index",
    "pages/upload/upload",
    "pages/split/split"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#667eea",
    "navigationBarTitleText": "è‡ªå®šä¹‰æ‹¼å›¾æ¸¸æˆ",
    "navigationBarTextStyle": "white"
  }
}
```

## ğŸ› è°ƒè¯•æŠ€å·§

### å‰ç«¯è°ƒè¯•

#### ä½¿ç”¨console.log
```javascript
console.log('è°ƒè¯•ä¿¡æ¯:', data);
wx.setStorageSync('debug_log', data);
```

#### æŸ¥çœ‹Storage
- å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ è°ƒè¯•å™¨ â†’ Storageæ ‡ç­¾

#### ç½‘ç»œè¯·æ±‚è°ƒè¯•
- å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ è°ƒè¯•å™¨ â†’ Networkæ ‡ç­¾
- æŸ¥çœ‹uploadFileçš„è¯·æ±‚å’Œå“åº”

### åç«¯è°ƒè¯•

#### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯æ§åˆ¶å°ç›´æ¥è¾“å‡ºæ—¥å¿—
INFO:åˆ‡å‰²ç¬¬1å—å®Œæˆ: abc123_1.jpg
```

#### æµ‹è¯•æ¥å£
```bash
# ä½¿ç”¨curlæµ‹è¯•
curl -X POST http://localhost:8000/upload \
  -F "file=@test.jpg"

# ä½¿ç”¨Pythonæµ‹è¯•
import requests
files = {'file': open('test.jpg', 'rb')}
response = requests.post('http://localhost:8000/upload', files=files)
print(response.json())
```

#### å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8000/health
# è¿”å›: {"status": "healthy", "service": "image-splitter"}
```

## ğŸ“± çœŸæœºè°ƒè¯•

### 1. ç¡®ä¿ç½‘ç»œè¿é€š
- ç”µè„‘å’Œæ‰‹æœºåœ¨åŒä¸€Wi-Fi
- æŸ¥çœ‹ç”µè„‘IPï¼š`ipconfig` (Windows) æˆ– `ifconfig` (Linux)

### 2. ä¿®æ”¹baseUrl
```javascript
baseUrl: "http://192.168.1.100:8000"  // æ›¿æ¢ä¸ºä½ çš„ç”µè„‘IP
```

### 3. å¾®ä¿¡å¼€å‘è€…å·¥å…·
- ç‚¹å‡»"çœŸæœºè°ƒè¯•"
- æ‰«æäºŒç»´ç 
- åœ¨æ‰‹æœºå¾®ä¿¡ä¸­æ‰“å¼€

## ğŸš€ éƒ¨ç½²ä¸Šçº¿

### åç«¯éƒ¨ç½²

#### æœ¬åœ°æœåŠ¡å™¨éƒ¨ç½²

1. **å†…ç½‘ç©¿é€**ï¼ˆæ¨èå¼€å‘æµ‹è¯•ï¼‰
   - ä½¿ç”¨ngrok
   ```bash
   ngrok http 8000
   # è·å¾—å…¬ç½‘URL
   ```

2. **äº‘æœåŠ¡å™¨éƒ¨ç½²**
   - å‚è§ `backend/README.md`
   - ä½¿ç”¨Gunicorn + Nginx

### å°ç¨‹åºä¸Šçº¿

#### 1. é…ç½®åˆæ³•åŸŸå
- å¾®ä¿¡å…¬ä¼—å¹³å° â†’ å¼€å‘ç®¡ç† â†’ æœåŠ¡å™¨åŸŸå
- æ·»åŠ  request åˆæ³•åŸŸåï¼š`https://your-domain.com`

#### 2. ä¸Šä¼ ä»£ç 
- å¾®ä¿¡å¼€å‘è€…å·¥å…· â†’ ä¸Šä¼ 
- å¡«å†™ç‰ˆæœ¬å·å’Œå¤‡æ³¨

#### 3. æäº¤å®¡æ ¸
- å¾®ä¿¡å…¬ä¼—å¹³å° â†’ ç‰ˆæœ¬ç®¡ç†
- æäº¤å®¡æ ¸
- ç­‰å¾…å®¡æ ¸é€šè¿‡ï¼ˆé€šå¸¸1-3å¤©ï¼‰

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

1. **å›¾ç‰‡å‹ç¼©**
```javascript
// ä¸Šä¼ å‰å‹ç¼©
wx.compressImage({
  src: tempFilePath,
  quality: 80,
  success: (res) => {
    this.uploadAndSplit(res.tempFilePath);
  }
});
```

2. **æ‡’åŠ è½½**
```wxml
<image lazy-load="{{true}}" src="{{item}}" />
```

3. **é˜²æŠ–å¤„ç†**
```javascript
// é¿å…å¿«é€Ÿç‚¹å‡»
const throttle = (fn, delay) => {
  let timer = null;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(this, args), delay);
  };
};
```

### åç«¯ä¼˜åŒ–

1. **å›¾ç‰‡è´¨é‡ä¼˜åŒ–**
```python
piece.save(piece_path, "JPEG", quality=85, optimize=True)
```

2. **ç¼“å­˜æœºåˆ¶**
```python
from functools import lru_cache

@lru_cache(maxsize=100)
def get_image_info(path):
    return Image.open(path)
```

3. **å¼‚æ­¥å¤„ç†**
```python
import asyncio

async def process_image(file):
    # å¼‚æ­¥å¤„ç†å›¾ç‰‡
    pass
```

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. æ–‡ä»¶ç±»å‹éªŒè¯
```python
ALLOWED_EXTENSIONS = {'.jpg', '.jpeg', '.png', '.webp'}

if not file.filename.lower().endswith(ALLOWED_EXTENSIONS):
    raise HTTPException(status_code=400, detail="ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹")
```

### 2. æ–‡ä»¶å¤§å°é™åˆ¶
```python
MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB

if len(content) > MAX_FILE_SIZE:
    raise HTTPException(status_code=400, detail="æ–‡ä»¶è¿‡å¤§")
```

### 3. CORSé…ç½®
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://your-miniapp.com"],  # å…·ä½“åŸŸå
    allow_credentials=True,
    allow_methods=["POST"],
    allow_headers=["*"],
)
```

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [å¾®ä¿¡å°ç¨‹åºæ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [FastAPIæ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Pillowæ–‡æ¡£](https://pillow.readthedocs.io/)

### å·¥å…·
- [å¾®ä¿¡å¼€å‘è€…å·¥å…·](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
- [Postman](https://www.postman.com/) (APIæµ‹è¯•)
- [ngrok](https://ngrok.com/) (å†…ç½‘ç©¿é€)

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä»£ç è§„èŒƒ
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- éµå¾ªPEP 8 (Python)
- éµå¾ªå¾®ä¿¡å°ç¨‹åºä»£ç è§„èŒƒ

### 2. ç‰ˆæœ¬æ§åˆ¶
```bash
git init
git add .
git commit -m "åˆå§‹ç‰ˆæœ¬"
git push origin main
```

### 3. æµ‹è¯•ç­–ç•¥
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- çœŸæœºæµ‹è¯•

### 4. æ–‡æ¡£ç»´æŠ¤
- åŠæ—¶æ›´æ–°README
- è®°å½•é‡è¦å˜æ›´
- ç»´æŠ¤APIæ–‡æ¡£

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q1: åç«¯å¯åŠ¨å¤±è´¥
A: æ£€æŸ¥ç«¯å£å ç”¨ï¼š`netstat -tulpn | grep 8000`

### Q2: å°ç¨‹åºæ— æ³•è¿æ¥åç«¯
A: æ£€æŸ¥CORSé…ç½®ï¼Œç¡®ä¿baseUrlæ­£ç¡®

### Q3: å›¾ç‰‡ä¸Šä¼ å¤±è´¥
A: æ£€æŸ¥æ–‡ä»¶å¤§å°ã€æ ¼å¼ï¼ŒæŸ¥çœ‹åç«¯æ—¥å¿—

### Q4: æ‹¼å›¾æ¸¸æˆå¼‚å¸¸
A: æ£€æŸ¥æ•°æ®ç»“æ„ï¼ŒéªŒè¯æ‰“ä¹±ç®—æ³•

### Q5: çœŸæœºè°ƒè¯•è¿ä¸ä¸Š
A: ç¡®ä¿åŒä¸€Wi-Fiï¼Œå…³é—­é˜²ç«å¢™

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…ï¼š
- `backend/README.md` - åç«¯éƒ¨ç½²æŒ‡å—
- `miniprogram/pages/split/README.md` - å‰ç«¯é…ç½®æŒ‡å—
- `å›¾ç‰‡å¤„ç†å¤±è´¥è¯Šæ–­æŒ‡å—.md` - é—®é¢˜è¯Šæ–­

---

**Happy Coding! ğŸš€**