<view class="container">
  <!-- 页面标题 -->
  <view class="header">
    <text class="title">智能图片切割拼图</text>
    <text class="subtitle">上传图片，自动切割成九宫格进行拼图</text>
  </view>

  <!-- 上传区域 -->
  <view class="upload-section" wx:if="{{!gameStarted}}">
    <view class="upload-box" bindtap="chooseImage">
      <image wx:if="{{originalImage}}" src="{{originalImage}}" class="preview-image" mode="aspectFit"></image>
      <view wx:else class="upload-placeholder">
        <text class="upload-icon">📷</text>
        <text class="upload-text">点击上传图片</text>
        <text class="upload-tips">支持JPG/PNG/WEBP格式</text>
      </view>
    </view>
    
    <view wx:if="{{gridImages.length > 0}}" class="grid-preview">
      <text class="grid-title">切割结果预览：</text>
      <view class="grid-container">
        <view wx:for="{{gridImages}}" wx:key="*this" class="grid-item">
          <image src="{{item}}" class="grid-image" mode="aspectFill"></image>
          <text class="grid-index">{{index + 1}}</text>
        </view>
      </view>
      
      <button class="start-btn" bindtap="startGame">开始拼图游戏</button>
    </view>
  </view>

  <!-- 游戏区域 -->
  <view class="game-section" wx:if="{{gameStarted}}">
    <!-- 游戏信息 -->
    <view class="game-info">
      <view class="info-item">
        <text class="info-label">步数：</text>
        <text class="info-value">{{steps}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">时间：</text>
        <text class="info-value">{{formatTime}}</text>
      </view>
    </view>

    <!-- 游戏控制 -->
    <view class="game-controls">
      <button class="control-btn" bindtap="toggleNumbers">{{showNumbers ? '隐藏' : '显示'}}数字</button>
      <button class="control-btn restart-btn" bindtap="restartGame">重新开始</button>
      <button class="control-btn reset-btn" bindtap="reset">重新上传</button>
    </view>

    <!-- 拼图区域 -->
    <view class="puzzle-container">
      <view class="puzzle-grid">
        <view 
          wx:for="{{puzzlePieces}}" 
          wx:key="id" 
          class="puzzle-piece {{item.isEmpty ? 'empty' : ''}} {{showNumbers ? 'show-number' : ''}}"
          data-index="{{index}}"
          bindtap="movePiece">
          <image wx:if="{{!item.isEmpty}}" src="{{item.imageUrl}}" class="piece-image" mode="aspectFill"></image>
          <text wx:if="{{showNumbers && !item.isEmpty}}" class="piece-number">{{item.originalPosition + 1}}</text>
          <text wx:if="{{item.isEmpty}}" class="empty-mark">空</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 胜利弹窗 -->
  <view class="victory-modal" wx:if="{{showVictory}}">
    <view class="modal-mask"></view>
    <view class="modal-content victory-content">
      <view class="victory-header">
        <text class="victory-icon">🎉</text>
        <text class="victory-title">恭喜完成！</text>
      </view>
      <view class="victory-stats">
        <view class="stat-item">
          <text class="stat-value">{{steps}}</text>
          <text class="stat-label">步数</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{formatTime}}</text>
          <text class="stat-label">用时</text>
        </view>
      </view>
      <view class="victory-actions">
        <button class="victory-btn primary" bindtap="restartGame">再玩一次</button>
        <button class="victory-btn secondary" bindtap="reset">上传新图</button>
      </view>
    </view>
  </view>

  <!-- 加载提示 -->
  <view class="loading-overlay" wx:if="{{uploading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">正在切割图片...</text>
    </view>
  </view>
</view>